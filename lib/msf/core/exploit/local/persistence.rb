# -*- coding: binary -*-

module Msf
  module Exploit::Local::Persistence
    def initialize(info = {})
      super(
        update_info(
          info,
          'DefaultOptions' => {
            'WfsDelay' => 90_000, # 25hrs
            'AllowNoCleanup' => true # don't delete our persistence after we get a shell
          },
          # https://github.com/rapid7/metasploit-framework/pull/19676#discussion_r1907594308
          'Stance' => Msf::Exploit::Stance::Passive
          # 'Passive' => true # XXX when set, ignores wfsdelay and immediately exists after last command
        )
      )

      register_advanced_options(
        [
          OptString.new('WritableDir', [true, 'A directory where we can write files', '/tmp/'])
        ]
      )
    end
  end
end
