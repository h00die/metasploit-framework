# -*- coding: binary -*-

module Msf
  # This module provides methods for persisting on a target system. Mainly initialization
  # options.
  module Exploit::Local::Persistence
    def initialize(info = {})
      super(
        update_info(
          info,
          'DefaultOptions' => {
            # leaving this commented out, we don't want a wfs delay so that the module
            # will run forever.
            # 'WfsDelay' => 25 * 60 * 60, # 25hrs
            'AllowNoCleanup' => true # don't delete our persistence after we get a shell
          },
          # https://github.com/rapid7/metasploit-framework/pull/19676#discussion_r1907594308
          'Stance' => Msf::Exploit::Stance::Passive
          # 'Passive' => true # XXX when set, ignores wfsdelay and immediately exists after last command
        )
      )

      register_advanced_options(
        [
          OptString.new('WritableDir', [true, 'A directory where we can write files', ''])
        ]
      )
    end
  end
end
